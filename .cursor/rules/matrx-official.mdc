---
description: 
alwaysApply: true
---

---
alwaysApply: true
---

# AI Matrx Development Guidelines

**Stack:** React 19, Next.js 16, Tailwind CSS, TypeScript, Redux (@/lib/redux/store.ts), Supabase (@/utils/supabase/client.ts)
**Lead Developer:** Arman (Expert in React 19, Next.js 15/16, Tailwind CSS, TypeScript, PostgreSQL and Python)

<file_organization>
**General directories** (small, reusable code):
- /components, /hooks, /utils, /constants, /types

**Feature directories** (/features/[feature-name]/) for complex features:
- index.ts (barrel exports)
- README.md (CONCISE post-completion documentation only, updated after every code modification)
- types.ts, components/, hooks/, service.ts|service/, utils.ts|utils/, constants.ts|constants/, state/
- Use single files; create directories only when multiple files needed
- Route example: app/(authenticated)/notes/page.tsx → Feature: features/notes/

**Rules:** Never save to project root. Respect existing structures.
</file_organization>

<code_standards>
- Extract complex logic into utilities
- Leverage existing ShadCN and custom components
- Follow React 19/Next.js 15/16 best practices
- Optimize for performance and scalability
- Simplify over-engineered code; avoid adding complexity
</code_standards>

<ui_ux_guidelines>
- Modern, professional, elegant interfaces
- Lucide React icons only (no emojis)
- **NEVER use browser alerts, confirms, prompts** - Always use custom components for notifications, confirmations, and user input (eg. @/components/ui/alert-dialog)
- **NEVER use Dialog on mobile** - Always use Drawer (bottom sheet) via `useIsMobile()` conditional rendering
- **NEVER use tabs on mobile** - Stack sections vertically with clear dividers (tabs cause UX friction)
- `bg-textured` for main backgrounds (textured bg-zinc-100 dark:bg-zinc-850)
- Consistent light/dark theme with proper contrast
- Space-efficient layouts (minimal padding/gaps, maintain readability)
- Desktop-first, mobile-responsive
- Component library loading states (no plain text)
- Proper Layout.tsx or page wrapper: `<div className="h-[calc(100vh-2.5rem)] flex flex-col overflow-hidden">`
</ui_ux_guidelines>

<mobile_layout_essentials>
1. **Viewport Heights:** Use `h-dvh`, `min-h-dvh`, `max-h-dvh` (NEVER `h-screen` or `min-h-screen`)
2. **Safe Areas:** Always add `pb-safe` to fixed bottom elements
3. **Header Height:** Use `--header-height` (2.5rem/h-10) - never hardcode
4. **Full-height pages:** `h-[calc(100dvh-var(--header-height))]` for content below header
5. **iOS Zoom Prevention:** Input/textarea must be `≥16px` font-size (use `text-base` or inline style)
6. **Header Injection:** Use `<PageSpecificHeader>` component - never create custom headers
7. **CRITICAL - Dialogs:** ALWAYS use `useIsMobile()` to conditionally render:
   - **Mobile:** `<Drawer>` with `max-h-[85dvh]` (bottom sheet)
   - **Desktop:** `<Dialog>` with `max-h-[90dvh]` (modal)
   - **NEVER use Dialog component on mobile**
8. **CRITICAL - Tabs:** NEVER use tabs on mobile:
   - **Mobile:** Stack all sections vertically with dividers
   - **Desktop:** Tabs OK (max 5 tabs)
   - Tabs cause UX friction and nested scrolling problems on mobile

**Common Pattern:**
```tsx
<div className="h-[calc(100dvh-var(--header-height))] flex flex-col overflow-hidden">
  <div className="flex-1 overflow-y-auto pb-safe">{/* Scrollable content */}</div>
  <div className="flex-shrink-0 pb-safe">{/* Fixed bottom */}</div>
</div>
```

**Dialog/Drawer Pattern (MANDATORY):**
```tsx
const isMobile = useIsMobile();
{isMobile ? (
  <Drawer open={isOpen} onOpenChange={setIsOpen}>
    <DrawerContent className="max-h-[85dvh]">
      <DrawerTitle className="sr-only">Title</DrawerTitle>
      <div className="flex-1 overflow-y-auto overscroll-contain pb-safe">
        {content}
      </div>
    </DrawerContent>
  </Drawer>
) : (
  <Dialog open={isOpen} onOpenChange={setIsOpen}>
    <DialogContent className="max-w-[95vw] w-full lg:max-w-[1400px] max-h-[90dvh] overflow-hidden flex flex-col">
      <DialogHeader><DialogTitle>Title</DialogTitle></DialogHeader>
      <div className="flex-1 overflow-y-auto">{content}</div>
    </DialogContent>
  </Dialog>
)}
```

*Full details: See `.cursor/skills/ios-mobile-first/SKILL.md` for comprehensive mobile UX guidelines*
</mobile_layout_essentials>

<navigation_interactions>
For clickable cards/routes:
- useTransition with startTransition
- Loading overlays with spinners on active elements
- Prevent duplicate actions
- Disable elements during transitions
- Handle edge cases and errors
</navigation_interactions>

<typescript_requirements>
- Complete type definitions
- Avoid 'any' types
- Leverage type inference
</typescript_requirements>

<design_tokens>
**Backgrounds:** `bg-textured`, `bg-background`, `bg-card`, `bg-muted`, `bg-accent`
**Colors:** `primary` (210/221° HSL), `secondary` (275° HSL), `destructive/success/warning/info`, `accent-2/accent-3`
**States:** `--primary/secondary/accent-hover/active`
**Other:** `--elevation-1/2/3`, `--gradient-1/2/3`
</design_tokens>

<error_handling>
- Comprehensive error boundaries
- User-friendly messages
- Appropriate logging
- Handle network failures and edge cases
</error_handling>

<performance>
- Code splitting where beneficial
- React.memo, useMemo appropriately
- Optimize re-renders and state updates
- Consider bundle size
- Avoid unnecessary useEffect dependencies
</performance>

<response_workflow>
1. Analyze existing patterns
2. Reuse components and utilities
3. Maintain consistency
4. Provide production-ready, typed code
5. Include comprehensive error handling
6. Consider performance
7. Maintain todo lists for tracking
8. Document only after testing confirms functionality
</response_workflow>

---

# CRITICAL: Task Execution Protocol

<task_workflow>

## Simple Requests
Execute immediately without ceremony.

## Complex Requests (Multiple Parts/Changes)

<planning_phase>
**STOP. PLAN FIRST. Do not write code until you complete these steps:**

1. **Understand the goal** - What does Arman actually need accomplished?
2. **Review ALL relevant code** - Files, components, utilities, types that will be affected
3. **Assess requirements** - Do you have everything needed?
   - If unclear: Ask **concise, direct questions** that impact implementation
   - Skip questions you can answer from existing code
4. **CREATE COMPLETE TASK LIST** - Break down every step required
   - Be thorough. Think through the entire implementation
   - Include: file changes, new files, component updates, type updates, testing considerations
   - **FINAL task must be:** "Update the single README.md with final documentation"
5. **Present task list to Arman** - Show your plan before executing
</planning_phase>

<execution_phase>
Work through tasks systematically until complete.
</execution_phase>

<documentation_rules>
## CRITICAL DOCUMENTATION RULES - READ CAREFULLY

**NEVER create multiple .md files. EVER.**

For each feature or route, there is ONLY ONE README.md file:
- Location: `/features/[feature-name]/README.md` OR at the route level if appropriate
- Created: ONLY AFTER all code is written and tested
- Updates: ALWAYS update the SAME file, never create new ones

**Forbidden:**
- ❌ Creating RECENT_FIXES.md, documentation-v2.md, final-docs.md, updated-readme.md, etc.
- ❌ Creating documentation during development
- ❌ Multiple .md files per feature
- ❌ Leaving outdated documentation

**Required:**
- ✅ ONE README.md per feature/route
- ✅ Create it ONLY when code is complete
- ✅ Update the SAME file if changes occur
- ✅ Keep it concise and current

**If a README.md already exists:** UPDATE IT. Do not create a new file.
</documentation_rules>

</task_workflow>

<critical_reminders>
**Before every response, verify:**
1. Have I planned thoroughly for complex requests?
2. Am I only creating/updating ONE README.md file?
3. Have I reviewed all relevant existing code?
4. Is my task list complete before I start coding?
</critical_reminders>
