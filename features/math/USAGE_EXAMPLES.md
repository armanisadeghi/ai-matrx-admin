# Math Problem Import - Usage Examples

These utilities handle importing AI-generated math problems into the database. **IDs are auto-generated** and problems should be **wrapped in `math_problem` key** for proper detection when generated by AI in chat.

## Quick Start

```typescript
import { 
  importMathProblem, 
  importMathProblems,
  importFromJSON,
  validateJSON 
} from '@/features/math/utils';
```

## Example 1: Import Single Problem

```typescript
const problem = {
  title: "Solving Linear Equations",
  course_name: "Mathematics",
  topic_name: "Algebra",
  module_name: "Foundations",
  problem_statement: {
    text: "Given the equation:",
    equation: "2x + 5 = 13",
    instruction: "Solve for x."
  },
  solutions: [{
    task: "Isolate x",
    steps: [{
      title: "Step 1: Subtract 5",
      equation: "2x = 8"
    }],
    solutionAnswer: "x = 4",
    transitionText: null
  }]
};

const result = await importMathProblem(problem);
if (result.success) {
  console.log('Problem imported!');
} else {
  console.error('Error:', result.error);
}
```

## Example 2: Import Multiple Problems

```typescript
const problems = [problem1, problem2, problem3];

const result = await importMathProblems(problems);
console.log(`Inserted: ${result.inserted}, Failed: ${result.failed}`);

if (result.errors.length > 0) {
  result.errors.forEach(err => {
    console.error(`${err.problem}: ${err.error}`);
  });
}
```

## Example 3: Import from AI-Generated JSON

```typescript
// JSON string from AI model (wrapped in math_problem key, no id field)
const aiOutput = `{
  "math_problem": {
    "title": "Two-Step Equations",
    "course_name": "Mathematics",
    "topic_name": "Algebra",
    "module_name": "Foundations of Algebra",
    "problem_statement": {
      "text": "Given the equation:",
      "equation": "2x + 5 = 13",
      "instruction": "Solve for x."
    },
    "solutions": [{
      "task": "Isolate x",
      "steps": [{
        "title": "Subtract 5 from both sides",
        "equation": "2x = 8",
        "explanation": "Undo addition by subtracting"
      }],
      "solutionAnswer": "x = 4",
      "transitionText": null
    }]
  }
}`;

const result = await importFromJSON(aiOutput);
if (result.success) {
  console.log(`Imported successfully!`);
} else {
  console.error('Errors:', result.errors);
}
```

**Note**: The `importFromJSON` function automatically handles both wrapped (`{ "math_problem": {...} }`) and direct formats for flexibility.

## Example 4: Validate Before Importing

```typescript
const aiOutput = `{
  "math_problem": {
    "title": "Quadratic Formula",
    ...
  }
}`;

// Validate first (without importing)
const validation = validateJSON(aiOutput);

if (validation.valid) {
  console.log('Valid! Ready to import.');
  const result = await importFromJSON(aiOutput);
  console.log('Imported:', result.inserted);
} else {
  // Show validation errors
  validation.problems.forEach(p => {
    if (!p.valid) {
      console.error(`${p.title}:`, p.errors);
    }
  });
}
```

## Example 5: Server Action for API Route

```typescript
// app/api/math/import/route.ts
import { importFromJSON } from '@/features/math/utils';

export async function POST(request: Request) {
  try {
    const { json } = await request.json();
    const result = await importFromJSON(json);
    
    return Response.json(result);
  } catch (error) {
    return Response.json({ 
      success: false, 
      error: 'Import failed' 
    }, { status: 500 });
  }
}
```

## Example 6: With Custom Validation

```typescript
// Skip validation for trusted sources
const result = await importMathProblem(problem, false);

// Or validate manually first
import { validateProblem } from '@/features/math/utils';

const validation = validateProblem(problem);
if (validation.valid) {
  await importMathProblem(problem, false);
}
```

## Example 7: Stop on First Error

```typescript
// Stop importing if any problem fails
const result = await importMathProblems(
  problems,
  true,  // validate
  true   // stopOnError
);

if (!result.success) {
  console.log('Import stopped due to error');
}
```

## TypeScript Types

```typescript
import type { 
  AIGeneratedProblem,
  ValidationResult,
  ImportResult 
} from '@/features/math/utils';

// Use for type checking
const myProblem: AIGeneratedProblem = {
  // TypeScript will ensure correct structure
  title: "...",
  // ...
};
```

